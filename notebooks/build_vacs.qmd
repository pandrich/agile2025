---
title: "VACS data cleaning"
format: html
editor: visual
---

# Environment Setup

```{r setup}
# Packages
library(tidyverse)

# Path Structure
root <- rprojroot::has_file("agile2025.Rproj")$make_fix_file()
raw_data_dir <- root("data/raw")
proc_data_dir <- root("data/processed")
vacs_data_dir <- file.path(proc_data_dir, "VACS_clean")

# File Naming
date <- lubridate::today()
```

# Notes

Both Zimbabwe and Zambia appear to contain information at a much more detailed spatial resolution?

# Import Data

## Mozambique

```{r}
vacs_moz <- (
  haven::read_dta(
    file.path(
      vacs_data_dir,
      "mozambique_pud_rurban.dta"
    )
  )
  %>% rename_with(tolower)
  %>% mutate(
    date = as.Date(hdate_f, format = "%Y-%m-%d"),
    country = "Mozambique",
    rural = if_else(type_name == "Rural", 1, 0),
    female = if_else(sex == 2, 1, 0),
    adm1_code = as.integer(prov),
    adm1_name = case_match(
      adm1_code,
      1 ~ "Niassa",
      2 ~ "Cabo Delgado",
      3 ~ "Nampula",
      4 ~ "Zambezia",
      5 ~ "Tete",
      6 ~ "Manica",
      7 ~ "Sofala",
      8 ~ "Inhambane",
      9 ~ "Gaza",
      10 ~ "Maputo",
      11 ~ "Maputo City"
    ),
    adm2_code = NA,
    adm2_name = NA,
    # hh_water_dist_km = h4a / 1000,
    hh_healthfac_dist_km = h4c / 1000,
    hh_school_dist_km = h4g / 1000,
    hh_electricity = case_when(
      h7a == 1 ~ 1,
      h7a == 2 ~ 0,
      .default = NA
    ),
    hh_mobile_phone = case_when(
      h7e == 1 ~ 1,
      h7e == 2 ~ 0,
      .default = NA
    ),
    hh_bike = case_when(
      h14b == 1 ~ 1,
      h14b == 2 ~ 0,
      .default = NA
    ),
    hh_motorbike = case_when(
      h14c == 1 ~ 1,
      h14c == 2 ~ 0,
      .default = NA
    ),
    hh_car = case_when(
      h14f == 1 ~ 1,
      h14f == 2 ~ 0,
      .default = NA
    ),
    hh_gov_support = case_when(
      h18 == 1 ~ 1,
      h18 == 2 ~ 0,
      .default = NA
    ),
    hh_non_gov_support = case_when(
      h19 %in% c(1, 2, 3, 88) ~ 1,
      h19 == 99 ~ NA,
      .default = 0
    ),
    hh_food_ins = if_else(
      h20 %in% seq(1, 5),
      abs(h20 - 5),
      NA
    ),
  #   attended_school = case_when(
  #     eversch == 1 ~ 1,
  #     eversch == 2 ~ 0,
  #     .default = NA
  #   ),
    in_school = case_when(
      currsch == 1 ~ 1,
      currsch %in% c(2, NA) ~ 0,
      .default = NA
    ),
  #   completed_school = case_when(
  #     schrsn == 5 ~ 1,
  #     schrsn %in% c(98, 99) ~ NA,
  #     .default = 0
  #   ),
    work = case_when(
      work == 1 ~ 1,
      work == 2 ~ 0,
      .default = NA
    ),
    # curr_relationship = case_when(
    #   marnow %in% c(1, 2) ~ 1,
    #   marnow %in% c(3, 4, 5, NA) ~ 0,
    #   .default = NA
    # ),
    live_with_mother = case_when(
      manow == 2 ~ 1,
      manow %in% c(1, NA) ~ 0,
      .default = NA
    ),
    live_with_father = case_when(
      fanow == 2 ~ 1,
      fanow %in% c(1, NA) ~ 0,
      .default = NA
    ),
    live_with_partner = case_when(
      marliv == 1 ~ 1,
      marliv %in% c(2, NA) ~ 0,
      .default = NA
    ),
    men_sex_control = case_when(
      gadsex == 1 ~ 1,
      gadsex == 2 ~ 0,
      .default = NA
    ),
    tolerate_women_violence = case_when(
        (
          gaviol == 1
          | wbout == 1
          | wbnegl == 1
          | wbarg == 1
          | wbsex == 1
          | wbburn == 1
        ) ~ 1,
        (
          gaviol == 2
          & wbout == 2
          & wbnegl == 2
          & wbarg == 2
          & wbsex == 2
          & wbburn == 2
        ) ~ 0,
        .default = NA
      ),
    # tolerate_child_violence = case_when(
    #   (cppar == 1) | (cpteach == 1) ~ 1,
    #   (cppar == 2) & (cpteach == 2) ~ 0,
    #   .default = NA
    # ),
    # tolerate_parents_child_violence = case_when(
    #   cppar == 1 ~ 1,
    #   cppar == 2 ~ 0,
    #   .default = NAva
    # ),
    sexexpl = case_when(
      (tsfrq12 >= 1) & (tsfrq12 < 98) ~ 1,
      tsfrq12 %in% c(98, 99) ~ NA,
      .default = 0
    ),
    sv_1 = case_when(
      svtch == 2 ~ 0,
      svtch == 1 & (sv112m == 2 | sv1ft12 == 2) ~ 0,
      svtch == 1 & (sv112m == 1 | sv1ft12 == 1) ~ 1,
      .default = NA
    ),
    sv_np_1 = case_when(
      is.na(sv_1) ~ NA,
      (sv1who > 88 & sv1ftr > 88) ~ NA,
      (sv_1 == 1 & (is.na(sv1who) & is.na(sv1ftr))) ~ NA,
      (sv_1 == 1 & (sv1who %in% c(5:20, 25:88) | sv1ftr %in% c(5:20, 25:88))) ~ 1,
      .default = 0
    ),
    sv_ip_1 = case_when(
      is.na(sv_1) ~ NA,
      (sv1who > 88 & sv1ftr > 88) ~ NA,
      (sv_1 == 1 & (is.na(sv1who) & is.na(sv1ftr))) ~ NA,
      (sv_1 == 1 & (sv1who %in% c(1:4, 21:24) | sv1ftr %in% c(1:4, 21:24))) ~ 1,
      .default = 0
    ),
    sv_2 = case_when(
      (svaffsx == 2 & svafsany == 2) ~ 0,
      (svaffsx == 1 | svafsany == 1) & (sv212m == 2 | sv2ft12 == 2) ~ 0,
      (svaffsx == 1 | svafsany == 1) & (sv212m == 1 | sv2ft12 == 1) ~ 1,
      .default = NA
    ),
    sv_np_2 = case_when(
      is.na(sv_2) ~ NA,
      (sv2who > 88 & sv2ftr > 88) ~ NA,
      (sv_2 == 1 & (is.na(sv2who) & is.na(sv2ftr))) ~ NA,
      (sv_2 == 1 & (sv2who %in% c(5:20, 25:88) | sv2ftr %in% c(5:20, 25:88))) ~ 1,
      .default = 0
    ),
    sv_ip_2 = case_when(
      is.na(sv_2) ~ NA,
      (sv2who > 88 & sv2ftr > 88) ~ NA,
      (sv_2 == 1 & (is.na(sv2who) & is.na(sv2ftr))) ~ NA,
      (sv_2 == 1 & (sv2who %in% c(1:4, 21:24) | sv2ftr %in% c(1:4, 21:24))) ~ 1,
      .default = 0
    ),
    sv_3 = case_when(
      (svpfssx == 2 & svpfsany == 2) ~ 0,
      (svpfssx == 1 | svpfsany == 1) & (sv312m == 2 | sv3ft12 == 2) ~ 0,
      (svpfssx == 1 | svpfsany == 1) & (sv312m == 1 | sv3ft12 == 1) ~ 1,
      .default = NA
    ),
    sv_np_3 = case_when(
      is.na(sv_3) ~ NA,
      (sv3who > 88 & sv3ftr > 88) ~ NA,
      (sv_3 == 1 & (is.na(sv3who) & is.na(sv3ftr))) ~ NA,
      (sv_3 == 1 & (sv3who %in% c(5:20, 25:88) | sv3ftr %in% c(5:20, 25:88))) ~ 1,
      .default = 0
    ),
    sv_ip_3 = case_when(
      is.na(sv_3) ~ NA,
      (sv3who > 88 & sv3ftr > 88) ~ NA,
      (sv_3 == 1 & (is.na(sv3who) & is.na(sv3ftr))) ~ NA,
      (sv_3 == 1 & (sv3who %in% c(1:4, 21:24) | sv3ftr %in% c(1:4, 21:24))) ~ 1,
      .default = 0
    ),
    sv_4 = case_when(
      (svprssx == 2 & svprsany == 2) ~ 0,
      (svprssx == 1 | svprsany == 1) & (sv412m == 2 | sv4ft12 == 2) ~ 0,
      (svprssx == 1 | svprsany == 1) & (sv412m == 1 | sv4ft12 == 1) ~ 1,
      .default = NA
    ),
    sv_np_4 = case_when(
      is.na(sv_4) ~ NA,
      (sv4who > 88 & sv4ftr > 88) ~ NA,
      (sv_4 == 1 & (is.na(sv4who) & is.na(sv4ftr))) ~ NA,
      (sv_4 == 1 & (sv4who %in% c(5:20, 25:88) | sv4ftr %in% c(5:20, 25:88))) ~ 1,
      .default = 0
    ),
    sv_ip_4 = case_when(
      is.na(sv_4) ~ NA,
      (sv4who > 88 & sv4ftr > 88) ~ NA,
      (sv_4 == 1 & (is.na(sv4who) & is.na(sv4ftr))) ~ NA,
      (sv_4 == 1 & (sv4who %in% c(1:4, 21:24) | sv4ftr %in% c(1:4, 21:24))) ~ 1,
      .default = 0
    ),
    sv_5 = case_when(
      (svaffsx == 2 & svafsxany == 2) ~ 0,
      (svaffsx == 1 | svafsxany == 1) & (sv512m == 2 | sv5ft12 == 2) ~ 0,
      (svaffsx == 1 | svafsxany == 1) & (sv512m == 1 | sv5ft12 == 1) ~ 1,
      .default = NA
    ),
    sv_np_5 = case_when(
      is.na(sv_5) ~ NA,
      (sv5who > 88 & sv5ftr > 88) ~ NA,
      (sv_5 == 1 & (is.na(sv5who) & is.na(sv5ftr))) ~ NA,
      (sv_5 == 1 & (sv5who %in% c(5:20, 25:88) | sv5ftr %in% c(5:20, 25:88))) ~ 1,
      .default = 0
    ),
    sv_ip_5 = case_when(
      is.na(sv_5) ~ NA,
      (sv5who > 88 & sv5ftr > 88) ~ NA,
      (sv_5 == 1 & (is.na(sv5who) & is.na(sv5ftr))) ~ NA,
      (sv_5 == 1 & (sv5who %in% c(1:4, 21:24) | sv5ftr %in% c(1:4, 21:24))) ~ 1,
      .default = 0
    ),
    sv = case_when(
      rowSums(across(c(sv_1, sv_2, sv_3, sv_4, sv_5)), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(c(sv_1, sv_2, sv_3, sv_4, sv_5)), na.rm = TRUE) == 0)
        & (if_any(c(sv_1, sv_2, sv_3, sv_4, sv_5), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    sv_np = case_when(
      rowSums(across(starts_with("sv_np")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_np")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_np"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_np = if_else(
    #   if_any(starts_with("sv_np"), ~ . == 1),
    #   1,
    #   0
    # ),
    sv_ip = case_when(
      rowSums(across(starts_with("sv_ip")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_ip")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_ip"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_ip = if_else(
    #   if_any(starts_with("sv_ip"), ~ . == 1),
    #   1,
    #   0
    # ),
    # sv_any = case_when(
    #   (
    #     sv112m == 1
    #     | sv1ft12 == 1
    #     | sv212m == 1
    #     | sv2ft12 == 1
    #     | sv312m == 1
    #     | sv3ft12 == 1
    #     | sv412m == 1
    #     | sv4ft12 == 1
    #   ) ~ 1,
    #   (
    #     sv112m %in% c(2, NA)
    #     | sv1ft12 %in% c(2, NA)
    #     | sv212m %in% c(2, NA)
    #     | sv2ft12 %in% c(2, NA)
    #     | sv312m %in% c(2, NA)
    #     | sv3ft12 %in% c(2, NA)
    #     | sv412m %in% c(2, NA)
    #     | sv4ft12 %in% c(2, NA)
    #   ) ~ 0,
    #   .default = NA
    # ),
  )
  # %>% filter(
  #   sex == 2,
  #   age <= 17
  # )
  %>% select(
    country,
    adm1_code,
    adm1_name,
    adm2_code,
    adm2_name,
    cluster,
    date,
    sample_weight = sampleweight,
    rural,
    female,
    age,
    hh_food_ins,
    # attended_school,
    in_school,
    # completed_school,
    # hh_food_ins,
    work,
    # ever_relationship,
    # curr_relationship,
    live_with_mother,
    live_with_father,
    live_with_partner,
    men_sex_control,
    tolerate_women_violence,
   # tolerate_parents_child_violence,
    sexexpl,
    sv,
    sv_np,
    sv_ip
    # water_dist_km,
    # healthfac_dist_km,
    # school_dist_km,
    # electricity,
    # mobile_phone,
    # bike,
    # motorbike,
    # car,
    # gov_support,
    # non_gov_support,
    # food_ins,
  )
)
```

## Zimbabwe

Zimbabwe potentially has a finer spatial resolution that we could use Which one is the cluster variable?

```{r}
vacs_zwe <- (
  haven::read_dta(
    file.path(
      vacs_data_dir,
      "zimbabwe_pud_rurban.dta"
    )
  )
  %>% rename_with(tolower)
  %>% mutate(
    date = as.Date(as.character(hdate_vf), format = "%Y%m%d"),
    country = "Zimbabwe",
    rural = if_else(areatype == "Rural", 1, 0),
    female = if_else(sex == "2", 1, 0),
    adm1_code = if_else(
      as.integer(prov) == 0,
      10,
      as.integer(prov)
    ),
    adm2_name = str_to_title(district),
    adm2_code = NA,
    hh_electricity = case_when(
      h18a == 1 ~ 1,
      h18a == 2 ~ 0,
      .default = NA
    ),
    hh_mobile_phone = case_when(
      h18e == 1 ~ 1,
      h18e == 2 ~ 0,
      .default = NA
    ),
    hh_car = case_when(
      h19e == 1 ~ 1,
      h19e == 2 ~ 0,
      .default = NA
    ),
    hh_food_ins = NA,
    in_school = case_when(
      q4 == 1 ~ 1,
      q4 %in% c(2, NA) ~ 0,
      .default = NA
    ),
    work = case_when(
      q13 == 1 ~ 1,
      q13 == 2 ~ 0,
      .default = NA
    ),
    live_with_mother = case_when(
      q17 == 1 ~ 1,
      q17 %in% c(2, 3) ~ 0,
      .default = NA
    ),
    live_with_father = case_when(
      q23 == 1 ~ 1,
      q23 %in% c(2, 3) ~ 0,
      .default = NA
    ),
    live_with_partner = case_when(
      (q34 == 1) | (q41 == 1) ~ 1,
      (q34 %in% c(2, NA)) & (q41 %in% c(2, NA)) ~ 0,
      .default = NA
    ),
    men_sex_control = case_when(
      q44a == 1 ~ 1,
      q44a == 2 ~ 0,
      .default = NA
    ),
    tolerate_women_violence = case_when(
      (
        q43a == 1
        | q43b == 1
        | q43c == 1
        | q43d == 1
        | q43e == 1
      ) ~ 1,
      (
        q43a == 2
        & q43b == 2
        & q43c == 2
        & q43d == 2
        & q43e == 2
      ) ~ 0,
      .default = NA
    ),
    # tolerate_parents_child_violence = case_when(
    #   q45 == 1 ~ 1,
    #   q45 == 2 ~ 0,
    #   .default = NA
    # ),
    sexexpl = case_when(
      (q507 >= 1) & (q507 < 98) ~ 1,
      q507 %in% c(98, 99) ~ NA,
      .default = 0
    ),
    sv_1 = case_when(
      q600 == 2 ~ 0,
      q600 == 1 & (q602 == 2 | q612 == 2) ~ 0,
      q600 == 1 & (q602 == 1 | q612 == 1) ~ 1,
      .default = NA
    ),
    sv_np_1 = case_when(
      is.na(sv_1) ~ NA,
      (q607 > 88 & q617 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q607) & is.na(q617))) ~ NA,
      (sv_1 == 1 & (q607 %in% c(5:16, 21:88) | q617 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_1 = case_when(
      is.na(sv_1) ~ NA,
      (q607 > 88 & q617 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q607) & is.na(q617))) ~ NA,
      (sv_1 == 1 & (q607 %in% c(1:4, 17:20) | q617 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_2 = case_when(
      q700 == 2 ~ 0,
      q700 == 1 & (q702 == 2 | q712 == 2) ~ 0,
      q700 == 1 & (q702 == 1 | q712 == 1) ~ 1,
      .default = NA
    ),
    sv_np_2 = case_when(
      is.na(sv_2) ~ NA,
      (q707 > 88 & q717 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q707) & is.na(q717))) ~ NA,
      (sv_2 == 1 & (q707 %in% c(5:88) | q717 %in% c(5:88))) ~ 1,
      .default = 0
    ),
    sv_ip_2 = case_when(
      is.na(sv_2) ~ NA,
      (q707 > 88 & q717 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q707) & is.na(q717))) ~ NA,
      (sv_2 == 1 & (q707 %in% c(1:4) | q717 %in% c(1:4))) ~ 1,
      .default = 0
    ),
    sv_3 = case_when(
      q800 == 2 ~ 0,
      q800 == 1 & (q802 == 2 | q815 == 2) ~ 0,
      q800 == 1 & (q802 == 1 | q815 == 1) ~ 1,
      .default = NA
    ),
    sv_np_3 = case_when(
      is.na(sv_3) ~ NA,
      (q807 > 88 & q820 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q807) & is.na(q820))) ~ NA,
      (sv_3 == 1 & (q807 %in% c(5:88) | q820 %in% c(5:88))) ~ 1,
      .default = 0
    ),
    sv_ip_3 = case_when(
      is.na(sv_3) ~ NA,
      (q807 > 88 & q820 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q807) & is.na(q820))) ~ NA,
      (sv_3 == 1 & (q807 %in% c(1:4) | q820 %in% c(1:4))) ~ 1,
      .default = 0
    ),
    sv_4 = case_when(
      q900 == 2 ~ 0,
      q900 == 1 & (q902 == 2 | q914 == 2) ~ 0,
      q900 == 1 & (q902 == 1 | q914 == 1) ~ 1,
      .default = NA
    ),
    sv_np_4 = case_when(
      is.na(sv_4) ~ NA,
      (q907 > 88 & q919 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q907) & is.na(q919))) ~ NA,
      (sv_4 == 1 & (q907 %in% c(5:88) | q919 %in% c(5:88))) ~ 1,
      .default = 0
    ),
    sv_ip_4 = case_when(
      is.na(sv_4) ~ NA,
      (q907 > 88 & q919 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q907) & is.na(q919))) ~ NA,
      (sv_4 == 1 & (q907 %in% c(1:4) | q919 %in% c(1:4))) ~ 1,
      .default = 0
    ),
    sv = case_when(
      rowSums(across(c(sv_1, sv_2, sv_3, sv_4)), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(c(sv_1, sv_2, sv_3, sv_4)), na.rm = TRUE) == 0)
        & (if_any(c(sv_1, sv_2, sv_3, sv_4), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    sv_np = case_when(
      rowSums(across(starts_with("sv_np")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_np")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_np"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_np = if_else(
    #   if_any(starts_with("sv_np"), ~ . == 1),
    #   1,
    #   0
    # ),
    sv_ip = case_when(
      rowSums(across(starts_with("sv_ip")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_ip")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_ip"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_ip = if_else(
    #   if_any(starts_with("sv_ip"), ~ . == 1),
    #   1,
    #   0
    # ),
    # sv = case_when(
    #   (
    #     q602 == 1
    #     | q612 == 1
    #     | q702 == 1
    #     | q712 == 1
    #     | q802 == 1
    #     | q815 == 1
    #     | q902 == 1
    #     | q914 == 1
    #   ) ~ 1,
    #   (
    #     q602 %in% c(2, NA)
    #     & q612 %in% c(2, NA)
    #     & q702 %in% c(2, NA)
    #     & q712 %in% c(2, NA)
    #     & q802 %in% c(2, NA)
    #     & q815 %in% c(2, NA)
    #     & q902 %in% c(2, NA)
    #     & q914 %in% c(2, NA)
    #   ) ~ 0,
    #   .default = NA
    # ),
  )
  # %>% filter(
  #   sex == 2,
  #   q2 <= 17
  # )
  %>% select(
    country,
    adm1_code,
    adm1_name = province,   #district1?
    adm2_code,
    adm2_name,
    cluster = psu,  #GeoCode
    date,
    sample_weight = finalwt,
    rural,
    female,
    age = q2,
    hh_food_ins,
    in_school,
    work,
    live_with_mother,
    live_with_father,
    live_with_partner,
    men_sex_control,
    tolerate_women_violence,
    # tolerate_parents_child_violence,
    sexexpl,
    sv,
    sv_np,
    sv_ip
  )
)
```

## Lesotho

```{r}
vacs_lso <- (
  haven::read_dta(
    file.path(
      vacs_data_dir,
      "lesotho_pud_rurban.dta"
    )
  )
  %>% rename_with(tolower)
  %>% mutate(
    date = as.Date(as.character(hdate_vf), format = "%Y%m%d"),
    country = "Lesotho",
    adm1_code = recode(
      district,
      "Botha-Botha" = 1,
      "Leribe" = 2,
      "Berea" = 3,
      "Maseru" = 4,
      "Mafeteng" = 5,
      "Mohale's Hoek" = 6,
      "Quthing" = 7,
      "Qacha's Nek" = 8,
      "Mokhotlong"= 9,
      "Thaba-Tseka" = 10
    ),
    adm2_name = NA,
    adm2_code = NA,
    rural = if_else(
      sett %in% c(2,3),
      1,
      0
    ),
    female = if_else(sex == 2, 1, 0),
    hh_electricity = case_when(
      h7a == 1 ~ 1,
      h7a == 2 ~ 0,
      .default = NA
    ),
    hh_mobile_phone = case_when(
      h7f == 1 ~ 1,
      h7f == 2 ~ 0,
      .default = NA
    ),
    hh_car = case_when(
      h14e == 1 ~ 1,
      h14e == 2 ~ 0,
      .default = NA
    ),
    hh_gov_support = case_when(
      h18 == 1 ~ 1,
      h18 == 2 ~ 0,
      .default = NA
    ),
    hh_non_gov_support = case_when(
      h19 %in% c(1, 2, 3, 88) ~ 1,
      h19 == 99 ~ NA,
      .default = 0
    ),
    hh_food_ins = if_else(
      h20 %in% seq(1, 5),
      abs(h20 - 5),
      NA
    ),
    in_school = case_when(
      q4 == 1 ~ 1,
      q4 %in% c(2, NA) ~ 0,
      .default = NA
    ),
    work = case_when(
      q11 == 1 ~ 1,
      q11 == 2 ~ 0,
      .default = NA
    ),
    live_with_mother = case_when(
      q20 == 2 ~ 1,
      q20 %in% c(1, NA) ~ 0,
      .default = NA
    ),
    live_with_father = case_when(
      q30 == 2 ~ 1,
      q30 %in% c(1, NA) ~ 0,
      .default = NA
    ),
    live_with_partner = case_when(
      q40 == 1 ~ 1,
      q40 %in% c(2, NA) ~ 0,
      .default = NA
    ),
    men_sex_control = case_when(
      q42a == 1 ~ 1,
      q42a == 2 ~ 0,
      .default = NA
    ),
    tolerate_women_violence = case_when(
      (
        q42c == 1
        | q42e == 1
        | q43a == 1
        | q43b == 1
        | q43c == 1
        | q43d == 1
        | q43e == 1
      ) ~ 1,
      (
        q42c == 2
        & q42e == 2
        & q43a == 2
        & q43b == 2
        & q43c == 2
        & q43d == 2
        & q43e == 2
      ) ~ 0,
      .default = NA
    ),
    # tolerate_child_violence = case_when(
    #   (q44 == 1) | (q45 == 1) ~ 1,
    #   (q44 == 2) & (q45 == 2) ~ 0,
    #   .default = NA
    # ),
    # tolerate_parents_child_violence = case_when(
    #   q44 == 1 ~ 1,
    #   q44 == 2 ~ 0,
    #   .default = NA
    # ),
    sexexpl = case_when(
      (q507 >= 1) & (q507 < 98) ~ 1,
      q507 %in% c(98, 99) ~ NA,
      .default = 0
    ),
    sv_1 = case_when(
      q600 == 2 ~ 0,
      q600 == 1 & (q602 == 2 | q609 == 2) ~ 0,
      q600 == 1 & (q602 == 1 | q609 == 1) ~ 1,
      .default = NA
    ),
    sv_np_1 = case_when(
      is.na(sv_1) ~ NA,
      (q605 > 88 & q612 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q605) & is.na(q612))) ~ NA,
      (sv_1 == 1 & (q605 %in% c(5:16, 21:88) | q612 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_1 = case_when(
      is.na(sv_1) ~ NA,
      (q605 > 88 & q612 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q605) & is.na(q612))) ~ NA,
      (sv_1 == 1 & (q605 %in% c(1:4, 17:20) | q612 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_2 = case_when(
      (q700a == 2 & q700b == 2) ~ 0,
      (q700a == 1 | q700b == 1) & (q702 == 2 | q709 == 2) ~ 0,
      (q700a == 1 | q700b == 1) & (q702 == 1 | q709 == 1) ~ 1,
      .default = NA
    ),
    sv_np_2 = case_when(
      is.na(sv_2) ~ NA,
      (q705 > 88 & q712 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q705) & is.na(q712))) ~ NA,
      (sv_2 == 1 & (q705 %in% c(5:16, 21:88) | q712 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_2 = case_when(
      is.na(sv_2) ~ NA,
      (q705 > 88 & q712 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q705) & is.na(q712))) ~ NA,
      (sv_2 == 1 & (q705 %in% c(1:4, 17:20) | q712 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_3 = case_when(
      (q800a == 2 & q800b == 2) ~ 0,
      (q800a == 1 | q800b == 1) & (q802 == 2 | q810 == 2) ~ 0,
      (q800a == 1 | q800b == 1) & (q802 == 1 | q810 == 1) ~ 1,
      .default = NA
    ),
    sv_np_3 = case_when(
      is.na(sv_3) ~ NA,
      (q805 > 88 & q813 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q805) & is.na(q813))) ~ NA,
      (sv_3 == 1 & (q805 %in% c(5:16, 21:88) | q813 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_3 = case_when(
      is.na(sv_3) ~ NA,
      (q805 > 88 & q813 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q805) & is.na(q813))) ~ NA,
      (sv_3 == 1 & (q805 %in% c(1:4, 17:20) | q813 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_4 = case_when(
      (q900a == 2 & q900b == 2) ~ 0,
      (q900a == 1 | q900b == 1) & (q902 == 2 | q909 == 2) ~ 0,
      (q900a == 1 | q900b == 1) & (q902 == 1 | q909 == 1) ~ 1,
      .default = NA
    ),
    sv_np_4 = case_when(
      is.na(sv_4) ~ NA,
      (q905 > 88 & q912 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q905) & is.na(q912))) ~ NA,
      (sv_4 == 1 & (q905 %in% c(5:16, 21:88) | q912 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_4 = case_when(
      is.na(sv_4) ~ NA,
      (q905 > 88 & q912 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q905) & is.na(q912))) ~ NA,
      (sv_4 == 1 & (q905 %in% c(1:4, 17:20) | q912 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_5 = case_when(
      (q1000a == 2 & q1000b == 2) ~ 0,
      (q1000a == 1 | q1000b == 1) & (q1002 == 2 | q1009 == 2) ~ 0,
      (q1000a == 1 | q1000b == 1) & (q1002 == 1 | q1009 == 1) ~ 1,
      .default = NA
    ),
    sv_np_5 = case_when(
      is.na(sv_5) ~ NA,
      (q1005 > 88 & q1012 > 88) ~ NA,
      (sv_5 == 1 & (is.na(q1005) & is.na(q1012))) ~ NA,
      (sv_5 == 1 & (q1005 %in% c(5:16, 21:88) | q1012 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_5 = case_when(
      is.na(sv_5) ~ NA,
      (q1005 > 88 & q1012 > 88) ~ NA,
      (sv_5 == 1 & (is.na(q1005) & is.na(q1012))) ~ NA,
      (sv_5 == 1 & (q1005 %in% c(1:4, 17:20) | q1012 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv = case_when(
      rowSums(across(c(sv_1, sv_2, sv_3, sv_4, sv_5)), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(c(sv_1, sv_2, sv_3, sv_4, sv_5)), na.rm = TRUE) == 0)
        & (if_any(c(sv_1, sv_2, sv_3, sv_4, sv_5), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    sv_np = case_when(
      rowSums(across(starts_with("sv_np")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_np")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_np"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_np = if_else(
    #   if_any(starts_with("sv_np"), ~ . == 1),
    #   1,
    #   0
    # ),
    sv_ip = case_when(
      rowSums(across(starts_with("sv_ip")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_ip")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_ip"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_ip = if_else(
    #   if_any(starts_with("sv_ip"), ~ . == 1),
    #   1,
    #   0
    # ),
    # sv = case_when(
    #   (
    #     q602 == 1
    #     | q609 == 1
    #     | q702 == 1
    #     | q709 == 1
    #     | q802 == 1
    #     | q810 == 1
    #     | q902 == 1
    #     | q909 == 1
    #     | q1002 == 1
    #     | q1009 == 1
    #   ) ~ 1,
    #   (
    #     q602 %in% c(2, NA)
    #     | q609 %in% c(2, NA)
    #     | q702 %in% c(2, NA)
    #     | q709 %in% c(2, NA)
    #     | q802 %in% c(2, NA)
    #     | q810 %in% c(2, NA)
    #     | q902 %in% c(2, NA)
    #     | q909 %in% c(2, NA)
    #     | q1002 %in% c(2, NA)
    #     | q1009 %in% c(2, NA)
    #   ) ~ 0,
    #   .default = NA
    # ),
  )
  # %>% filter(
  #   sex == 2,
  #   q2 <= 17
  # )
  %>% select(
    country,
    adm1_code,
    adm1_name = district,
    adm2_code,
    adm2_name,
    cluster = psu,
    date,
    sample_weight = individual_weight1,
    rural,
    female,
    age = q2,
    hh_food_ins,
    in_school,
    work,
    live_with_mother,
    live_with_father,
    live_with_partner,
    men_sex_control,
    tolerate_women_violence,
    # tolerate_parents_child_violence,
    sexexpl,
    sv,
    sv_np,
    sv_ip
  )
)
```

## Namibia

```{r}
vacs_nam <- (
  haven::read_dta(
    file.path(
      vacs_data_dir,
      "namibia_pubuse_092923.dta"
    )
  )
  %>% rename_with(tolower)
  %>% mutate(
    date = as.Date(str_split_i(hdate_f, "T", 1), format = "%Y-%m-%d"),
    country = "Namibia",
    adm1_name = str_split_i(strata, " - ", 1),
    adm1_name = case_match(
      adm1_name,
      "Kavango East" ~ "Kavango",
      "Kavango West" ~ "Kavango",
      "Omaheke_Otjo" ~ "Omaheke",
      "Kunene_Omusa" ~ "Kunene",
      .default = adm1_name
    ),
    adm1_code = case_when(
      adm1_name == "Zambezi" ~ 1,
      adm1_name == "!Karas" ~ 4,
      adm1_name == "Kavango" ~ 5,
      .default = reg
    ),
    adm2_name = NA,
    adm2_code = NA,
    rural = if_else(
      str_split_i(strata, " - ", 2) == "Rural",
      1,
      0
    ),
    female = if_else(sex == 2, 1, 0),
    q40 = as.integer(q40),
    hh_electricity = case_when(
      h7a == 1 ~ 1,
      h7a == 2 ~ 0,
      .default = NA
    ),
    hh_mobile_phone = case_when(
      h7e == 1 ~ 1,
      h7e == 2 ~ 0,
      .default = NA
    ),
    hh_car = case_when(
      h14g == 1 ~ 1,
      h14g == 2 ~ 0,
      .default = NA
    ),
    hh_gov_support = case_when(
      h18 == 1 ~ 1,
      h18 == 2 ~ 0,
      .default = NA
    ),
    hh_non_gov_support = case_when(
      h19 == 1 ~ 1,
      h19 == 2 ~ 0,
      .default = NA
    ),
    hh_food_ins = if_else(
      h20 %in% seq(1, 5),
      abs(h20 - 5),
      NA
    ),
    in_school = case_when(
      q4 == 1 ~ 1,
      q4 %in% c(2, NA) ~ 0,
      .default = NA
    ),
    work = case_when(
      q11 == 1 ~ 1,
      q11 == 2 ~ 0,
      .default = NA
    ),
    live_with_mother = case_when(
      q20 == 2 ~ 1,
      q20 %in% c(1, NA) ~ 0,
      .default = NA
    ),
    live_with_father = case_when(
      q30 == 2 ~ 1,
      q30 %in% c(1, NA) ~ 0,
      .default = NA
    ),
    live_with_partner = case_when(
      q40 == 1 ~ 1,
      q40 %in% c(2, NA) ~ 0,
      .default = NA
    ),
    men_sex_control = case_when(
      q42a == 1 ~ 1,
      q42a == 2 ~ 0,
      .default = NA
    ),
    tolerate_women_violence = case_when(
      (
        q42c == 1
        | q42e == 1
        | q43a == 1
        | q43b == 1
        | q43c == 1
        | q43d == 1
        | q43e == 1
      ) ~ 1,
      (
        q42c == 2
        & q42e == 2
        & q43a == 2
        & q43b == 2
        & q43c == 2
        & q43d == 2
        & q43e == 2
      ) ~ 0,
      .default = NA
    ),
    # tolerate_child_violence = case_when(
    #   (q44 == 1) | (q45 == 1) ~ 1,
    #   (q44 == 2) & (q45 == 2) ~ 0,
    #   .default = NA
    # ),
    # tolerate_parents_child_violence = case_when(
    #   q44 == 1 ~ 1,
    #   q44 == 2 ~ 0,
    #   .default = NA
    # ),
    q100c1 = case_when(
      q100c1 == "" ~ NA,
      q100c1 == "1" ~ 1,
      q100c1 == "2" ~ 2
    ),
    sexexpl = case_when(
      (q507 >= 1) & (q507 < 98) ~ 1,
      q507 %in% c(98, 99) ~ NA,
      .default = 0
    ),
    sv_1 = case_when(
      q600 == 2 ~ 0,
      q600 == 1 & (q602 == 2 | q609 == 2) ~ 0,
      q600 == 1 & (q602 == 1 | q609 == 1) ~ 1,
      .default = NA
    ),
    sv_np_1 = case_when(
      is.na(sv_1) ~ NA,
      (q605 > 88 & q612 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q605) & is.na(q612))) ~ NA,
      (sv_1 == 1 & (q605 %in% c(5:18, 22:88) | q612 %in% c(5:18, 22:88))) ~ 1,
      .default = 0
    ),
    sv_ip_1 = case_when(
      is.na(sv_1) ~ NA,
      (q605 > 88 & q612 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q605) & is.na(q612))) ~ NA,
      (sv_1 == 1 & (q605 %in% c(1:4, 19:21) | q612 %in% c(1:4, 19:21))) ~ 1,
      .default = 0
    ),
    sv_2 = case_when(
      (q700a == 2 & q700b == 2) ~ 0,
      (q700a == 1 | q700b == 1) & (q702 == 2 | q709 == 2) ~ 0,
      (q700a == 1 | q700b == 1) & (q702 == 1 | q709 == 1) ~ 1,
      .default = NA
    ),
    sv_np_2 = case_when(
      is.na(sv_2) ~ NA,
      (q705 > 88 & q712 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q705) & is.na(q712))) ~ NA,
      (sv_2 == 1 & (q705 %in% c(5:18, 22:88) | q712 %in% c(5:18, 22:88))) ~ 1,
      .default = 0
    ),
    sv_ip_2 = case_when(
      is.na(sv_2) ~ NA,
      (q705 > 88 & q712 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q705) & is.na(q712))) ~ NA,
      (sv_2 == 1 & (q705 %in% c(1:4, 19:21) | q712 %in% c(1:4, 19:21))) ~ 1,
      .default = 0
    ),
    sv_3 = case_when(
      (q800a == 2 & q800b == 2) ~ 0,
      (q800a == 1 | q800b == 1) & (q802 == 2 | q810 == 2) ~ 0,
      (q800a == 1 | q800b == 1) & (q802 == 1 | q810 == 1) ~ 1,
      .default = NA
    ),
    sv_np_3 = case_when(
      is.na(sv_3) ~ NA,
      (q805 > 88 & q813 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q805) & is.na(q813))) ~ NA,
      (sv_3 == 1 & (q805 %in% c(5:18, 22:88) | q813 %in% c(5:18, 22:88))) ~ 1,
      .default = 0
    ),
    sv_ip_3 = case_when(
      is.na(sv_3) ~ NA,
      (q805 > 88 & q813 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q805) & is.na(q813))) ~ NA,
      (sv_3 == 1 & (q805 %in% c(1:4, 19:21) | q813 %in% c(1:4, 19:21))) ~ 1,
      .default = 0
    ),
    sv_4 = case_when(
      (q900a == 2 & q900b == 2) ~ 0,
      (q900a == 1 | q900b == 1) & (q902 == 2 | q909 == 2) ~ 0,
      (q900a == 1 | q900b == 1) & (q902 == 1 | q909 == 1) ~ 1,
      .default = NA
    ),
    sv_np_4 = case_when(
      is.na(sv_4) ~ NA,
      (q905 > 88 & q912 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q905) & is.na(q912))) ~ NA,
      (sv_4 == 1 & (q905 %in% c(5:18, 22:88) | q912 %in% c(5:18, 22:88))) ~ 1,
      .default = 0
    ),
    sv_ip_4 = case_when(
      is.na(sv_4) ~ NA,
      (q905 > 88 & q912 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q905) & is.na(q912))) ~ NA,
      (sv_4 == 1 & (q905 %in% c(1:4, 19:21) | q912 %in% c(1:4, 19:21))) ~ 1,
      .default = 0
    ),
    sv_5 = case_when(
      (q1000a == 2 & q1000b == 2) ~ 0,
      (q1000a == 1 | q1000b == 1) & (q1002 == 2 | q1009 == 2) ~ 0,
      (q1000a == 1 | q1000b == 1) & (q1002 == 1 | q1009 == 1) ~ 1,
      .default = NA
    ),
    sv_np_5 = case_when(
      is.na(sv_5) ~ NA,
      (q1005 > 88 & q1012 > 88) ~ NA,
      (sv_5 == 1 & (is.na(q1005) & is.na(q1012))) ~ NA,
      (sv_5 == 1 & (q1005 %in% c(5:18, 22:88) | q1012 %in% c(5:18, 22:88))) ~ 1,
      .default = 0
    ),
    sv_ip_5 = case_when(
      is.na(sv_5) ~ NA,
      (q1005 > 88 & q1012 > 88) ~ NA,
      (sv_5 == 1 & (is.na(q1005) & is.na(q1012))) ~ NA,
      (sv_5 == 1 & (q1005 %in% c(1:4, 19:21) | q1012 %in% c(1:4, 19:21))) ~ 1,
      .default = 0
    ),
    sv = case_when(
      rowSums(across(c(sv_1, sv_2, sv_3, sv_4, sv_5)), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(c(sv_1, sv_2, sv_3, sv_4, sv_5)), na.rm = TRUE) == 0)
        & (if_any(c(sv_1, sv_2, sv_3, sv_4, sv_5), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    sv_np = case_when(
      rowSums(across(starts_with("sv_np")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_np")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_np"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_np = if_else(
    #   if_any(starts_with("sv_np"), ~ . == 1),
    #   1,
    #   0
    # ),
    sv_ip = case_when(
      rowSums(across(starts_with("sv_ip")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_ip")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_ip"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_ip = if_else(
    #   if_any(starts_with("sv_ip"), ~ . == 1),
    #   1,
    #   0
    # ),
    # sv = case_when(
    #   (
    #     q602 == 1
    #     | q609 == 1
    #     | q702 == 1
    #     | q709 == 1
    #     | q802 == 1
    #     | q810 == 1
    #     | q902 == 1
    #     | q909 == 1
    #     | q1002 == 1
    #     | q1009 == 1
    #   ) ~ 1,
    #   (
    #     q602 %in% c(2, NA)
    #     | q609 %in% c(2, NA)
    #     | q702 %in% c(2, NA)
    #     | q709 %in% c(2, NA)
    #     | q802 %in% c(2, NA)
    #     | q810 %in% c(2, NA)
    #     | q902 %in% c(2, NA)
    #     | q909 %in% c(2, NA)
    #     | q1002 %in% c(2, NA)
    #     | q1009 %in% c(2, NA)
    #   ) ~ 0,
    #   .default = NA
    # ),
  )
  # # %>% filter(
  # #   sex == 2,
  # #   q2 <= 17
  # # )
  
  %>% select(
    country,
    adm1_code,
    adm1_name,
    adm2_code,
    adm2_name,
    cluster = ea,
    date,
    sample_weight = sampleweight,
    rural,
    female,
    age = q2,
    hh_food_ins,
    in_school,
    work,
    live_with_mother,
    live_with_father,
    live_with_partner,
    men_sex_control,
    tolerate_women_violence,
    # tolerate_parents_child_violence,
    sexexpl,
    sv,
    sv_np,
    sv_ip
  )
)
```

## Zambia

I believe that `region` indicates if the region is rural or urban. I'm guessing 1 = urban and 2 = rural Why are there 30 sex variables???

### Female

```{r}
vacs_zmbf <- (
  haven::read_dta(
    file.path(
      vacs_data_dir,
      "zambiaf_pud_rurban.dta"
    )
  )
  %>% rename_with(tolower)
  %>% mutate(
    female = 1
  )
)
```

### Male

```{r}
vacs_zmbm <- (
  haven::read_dta(
    file.path(
      vacs_data_dir,
      "zambiam_pud_rurban.dta"
    )
  )
  %>% rename_with(tolower)
  %>% mutate(
    female = 0
  )
)
```

```{r}
vacs_zmb <- (
  bind_rows(vacs_zmbf, vacs_zmbm)
  %>% mutate(
    date = lubridate::make_date(year = hyr_vf, month = hmth_vf, day = hday_vf),
    country = "Zambia",
    adm1_name = case_match(
      prov,
      1 ~ "Central",
      2 ~ "Copperbelt",
      3 ~ "Eastern",
      4 ~ "Luapula",
      5 ~ "Lusaka",
      6 ~ "Muchinga",
      7 ~ "Northern",
      8 ~ "North Western",
      9 ~ "Southern",
      10 ~ "Western"
    ),
    adm2_name = NA,
    rural = if_else(
      region == 2,
      1,
      0
    ),
    hh_electricity = case_when(
      h7a == 1 ~ 1,
      h7a == 2 ~ 0,
      .default = NA
    ),
    hh_mobile_phone = case_when(
      h7e == 1 ~ 1,
      h7e == 2 ~ 0,
      .default = NA
    ),
    hh_car = case_when(
      h14e == 1 ~ 1,
      h14e == 2 ~ 0,
      .default = NA
    ),
    hh_gov_support = NA,
    hh_non_gov_support = NA,
    hh_food_ins = NA,
    in_school = case_when(
      q4 == 1 ~ 1,
      q4 %in% c(2, NA) ~ 0,
      .default = NA
    ),
    work = case_when(
      q11 == 1 ~ 1,
      q11 == 2 ~ 0,
      .default = NA
    ),
    live_with_mother = case_when(
      q13 == 1 ~ 1,
      q13 == 2 ~ 0,
      .default = NA
    ),
    live_with_father = case_when(
      q19 == 1 ~ 1,
      q19 == 2 ~ 0,
      .default = NA
    ),
    live_with_partner = case_when(
      (q28 == 1) | (q31 == 1) ~ 1,
      (q28 %in% c(2, NA)) & (q31 %in% c(2, NA)) ~ 0,
      .default = NA
    ),
    men_sex_control = case_when(
      q34a == 1 ~ 1,
      q34a == 2 ~ 0,
      .default = NA
    ),
    tolerate_women_violence = case_when(
      (
        q33a == 1
        | q33b == 1
        | q33c == 1
        | q33d == 1
        | q33e == 1
        | q34e == 1
      ) ~ 1,
      (
        q33a == 2
        & q33b == 2
        & q33c == 2
        & q33d == 2
        & q33e == 2
        & q34e == 2
      ) ~ 0,
      .default = NA
    ),
    # tolerate_parents_child_violence = case_when(
    #   q35 == 1 ~ 1,
    #   q35 == 2 ~ 0,
    #   .default = NA
    # ),
    sexexpl = case_when(
      (q508 >= 1) & (q508 < 98) ~ 1,
      q508 %in% c(98, 99) ~ NA,
      .default = 0
    ),
    sv_1 = case_when(
      q700 == 2 ~ 0,
      q700 == 1 & (q702 == 2 | q712 == 2) ~ 0,
      q700 == 1 & (q702 == 1 | q712 == 1) ~ 1,
      .default = NA
    ),
    sv_np_1 = case_when(
      is.na(sv_1) ~ NA,
      (q707 > 88 & q717 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q707) & is.na(q717))) ~ NA,
      (sv_1 == 1 & (q707 %in% c(5:16, 21:88) | q717 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_1 = case_when(
      is.na(sv_1) ~ NA,
      (q707 > 88 & q717 > 88) ~ NA,
      (sv_1 == 1 & (is.na(q707) & is.na(q717))) ~ NA,
      (sv_1 == 1 & (q707 %in% c(1:4, 17:20) | q717 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_2 = case_when(
      q800 == 2 ~ 0,
      q800 == 1 & (q802 == 2 | q812 == 2) ~ 0,
      q800 == 1 & (q802 == 1 | q812 == 1) ~ 1,
      .default = NA
    ),
    sv_np_2 = case_when(
      is.na(sv_2) ~ NA,
      (q807 > 88 & q817 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q807) & is.na(q817))) ~ NA,
      (sv_2 == 1 & (q807 %in% c(5:16, 21:88) | q817 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_2 = case_when(
      is.na(sv_2) ~ NA,
      (q807 > 88 & q817 > 88) ~ NA,
      (sv_2 == 1 & (is.na(q807) & is.na(q817))) ~ NA,
      (sv_2 == 1 & (q807 %in% c(1:4, 17:20) | q817 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_3 = case_when(
      q900 == 2 ~ 0,
      q900 == 1 & (q902 == 2 | q915 == 2) ~ 0,
      q900 == 1 & (q902 == 1 | q915 == 1) ~ 1,
      .default = NA
    ),
    sv_np_3 = case_when(
      is.na(sv_3) ~ NA,
      (q907 > 88 & q920 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q907) & is.na(q920))) ~ NA,
      (sv_3 == 1 & (q907 %in% c(5:16, 21:88) | q920 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_3 = case_when(
      is.na(sv_3) ~ NA,
      (q907 > 88 & q920 > 88) ~ NA,
      (sv_3 == 1 & (is.na(q907) & is.na(q920))) ~ NA,
      (sv_3 == 1 & (q907 %in% c(1:4, 17:20) | q920 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv_4 = case_when(
      q1000 == 2 ~ 0,
      q1000 == 1 & (q1002 == 2 | q1014 == 2) ~ 0,
      q1000 == 1 & (q1002 == 1 | q1014 == 1) ~ 1,
      .default = NA
    ),
    sv_np_4 = case_when(
      is.na(sv_4) ~ NA,
      (q1007 > 88 & q1019 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q1007) & is.na(q1019))) ~ NA,
      (sv_4 == 1 & (q1007 %in% c(5:16, 21:88) | q1019 %in% c(5:16, 21:88))) ~ 1,
      .default = 0
    ),
    sv_ip_4 = case_when(
      is.na(sv_4) ~ NA,
      (q1007 > 88 & q1019 > 88) ~ NA,
      (sv_4 == 1 & (is.na(q1007) & is.na(q1019))) ~ NA,
      (sv_4 == 1 & (q1007 %in% c(1:4, 17:20) | q1019 %in% c(1:4, 17:20))) ~ 1,
      .default = 0
    ),
    sv = case_when(
      rowSums(across(c(sv_1, sv_2, sv_3, sv_4)), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(c(sv_1, sv_2, sv_3, sv_4)), na.rm = TRUE) == 0)
        & (if_any(c(sv_1, sv_2, sv_3, sv_4), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    sv_np = case_when(
      rowSums(across(starts_with("sv_np")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_np")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_np"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_np = if_else(
    #   if_any(starts_with("sv_np"), ~ . == 1),
    #   1,
    #   0
    # ),
    sv_ip = case_when(
      rowSums(across(starts_with("sv_ip")), na.rm = TRUE) > 0 ~ 1,
      (
        (rowSums(across(starts_with("sv_ip")), na.rm = TRUE) == 0)
        & (if_any(starts_with("sv_ip"), ~ is.na(.)))
      ) ~ NA,
      .default = 0
    ),
    # sv_ip = if_else(
    #   if_any(starts_with("sv_ip"), ~ . == 1),
    #   1,
    #   0
    # ),
    # sv = case_when(
    #   (
    #     q702 == 1
    #     | q712 == 1
    #     | q802 == 1
    #     | q812 == 1
    #     | q902 == 1
    #     | q915 == 1
    #     | q1002 == 1
    #     | q1014 == 1
    #   ) ~ 1,
    #   (
    #     q702 %in% c(2, NA)
    #     | q712 %in% c(2, NA)
    #     | q802 %in% c(2, NA)
    #     | q812 %in% c(2, NA)
    #     | q902 %in% c(2, NA)
    #     | q915 %in% c(2, NA)
    #     | q1002 %in% c(2, NA)
    #     | q1014 %in% c(2, NA)
    #   ) ~ 0,
    #   .default = NA
    # ),
  )
  # # # %>% filter(
  # # #   sex == 2,
  # # #   q2 <= 17
  # # # )
  %>% select(
    country,
    adm1_code = prov,
    adm1_name,
    adm2_code = dist,
    adm2_name,
    cluster = psu,
    date,
    sample_weight = finalwgt,
    rural,
    female,
    age = q2,
    hh_food_ins,
    in_school,
    work,
    live_with_mother,
    live_with_father,
    live_with_partner,
    men_sex_control,
    tolerate_women_violence,
    # tolerate_parents_child_violence,
    sexexpl,
    sv,
    sv_np,
    sv_ip
  )
)
```

df# Combine

```{r}
df_vacs <- bind_rows(vacs_moz, vacs_zwe, vacs_lso, vacs_nam, vacs_zmb)
```

```{r}
df_vacs %>% write_csv(file.path(proc_data_dir, paste0("vacs_clean_", date, ".csv")))
```

```{r}
(
  df_vacs
  %>% filter(
    is.na(date)
  )
)
```
